"use strict";(self.webpackChunkopl_frontend=self.webpackChunkopl_frontend||[]).push([[724],{724:function(e,t,r){r.r(t),r.d(t,{default:function(){return I}});var n=r(5861),s=r(5671),a=r(3144),i=r(136),o=r(5716),c=r(7757),u=r.n(c),l=r(2791),d=r(6168),h=r(9743),m=r(2677),p=r(717),_=r(4292),f=r(3360),v=r(6871),x=r(4475),y=r(4650),j=r(2591),C=r(184),N=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;(0,s.Z)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).state={info:[]},e.total=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!0===t?e.reduce((function(e,t){return e+t.count}),0):e.reduce((function(e,t){return e+t.sum}),0)},e}return(0,a.Z)(r,[{key:"numberWithCommas",value:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{key:"render",value:function(){return(0,C.jsxs)("div",{className:"customer-content__header",children:[(0,C.jsx)("h5",{className:"customer-content__header__name",children:this.props.name}),(0,C.jsx)("div",{className:"customer-info",children:(0,C.jsxs)(j.Z,{striped:!0,bordered:!0,hover:!0,size:"sm",children:[(0,C.jsx)("thead",{children:(0,C.jsxs)("tr",{children:[(0,C.jsx)("th",{children:"Total Sales"}),(0,C.jsx)("th",{children:"Total Amount"})]})}),(0,C.jsx)("tbody",{children:void 0===this.state.info?(0,C.jsxs)("tr",{children:[(0,C.jsx)("td",{children:"0"}),(0,C.jsx)("td",{children:"0"})]}):(0,C.jsxs)("tr",{children:[(0,C.jsx)("td",{children:this.total(this.state.info.months,!0)}),(0,C.jsx)("td",{children:this.numberWithCommas(this.total(this.state.info.months))})]})})]})})]})}}]),r}(l.Component);N.getDerivedStateFromProps=function(e,t){var r=e.customer.filter((function(t){return t.year===parseInt(e.customer_year)}));return t.info=r[0],t};var Z=(0,d.$j)((function(e){return{}}),{})(N),b=r(9600),g=r(3496),k=r(3847),T=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e)).state={series:[],options:{chart:{type:"bar",height:350},title:{text:"Monthly Sale Comparison"},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{title:{text:"Months"},categories:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"]},yaxis:{title:{text:n.props.dashboard_metric?"Kshs (Millions)":"Litres"}},fill:{opacity:1},tooltip:{y:{formatter:n.props.dashboard_metric?function(e){return"Kshs "+e+" Million"}:function(e){return e+" Litres"}}}}},n}return(0,a.Z)(r,[{key:"render",value:function(){return(0,C.jsx)("div",{id:"chart",children:(0,C.jsx)(g.Z,{options:this.state.options,series:this.state.series,type:"bar",height:350})})}}]),r}(l.Component);T.getDerivedStateFromProps=function(e,t){var r=void 0!==e.customer?function(e,t,r){if(void 0===e||null===e||e===[])return null;var n=e.filter((function(e){return e.year===parseInt(t)})),s=new Array(12).fill(0);for(var a in e=n.length>0?n[0].months:[]){var i=e[a];s[i.date__month-1]="Million"===r?(0,k.$G)(i.sum/1e7):(0,k.$G)(i.sum/1e3)}return s}(e.customer,e.customer_year,e.currency_type):null,n=[{name:e.dashboard_metric?"Revenue":"Quantity",data:null===r?[]:r}];return t.series=n,t.options.yaxis.title.text=e.dashboard_metric?"Customer Revenue":"Customer Quantity",t};var S=(0,d.$j)((function(e){return{}}),{})(T),E=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;(0,s.Z)(this,r);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={year:e.props.customer_year},e.handleYearChange=function(){var t=(0,n.Z)(u().mark((function t(r){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.UPDATE_CUSTOMER_YEAR_ACTION(r);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return(0,a.Z)(r,[{key:"render",value:function(){var e=this;return(0,C.jsx)("div",{className:"pie-select",children:(0,C.jsxs)(p.Z.Group,{className:"mb-4 pie-select__child",controlId:"exampleForm.ControlInput1",children:[(0,C.jsx)(p.Z.Label,{children:"Year"}),(0,C.jsxs)(p.Z.Select,{"aria-label":"Default select example",size:"sm",onChange:function(t){return e.handleYearChange(t.target.value)},children:[(0,C.jsx)("option",{children:this.state.year}),[2022,2021].map((function(t,r){return parseInt(e.state.year)===t?null:(0,C.jsx)("option",{value:t,children:t},r)}))]})]})})}}]),r}(l.Component);E.getDerivedStateFromProps=function(e,t){return t.year=parseInt(e.customer_year),t};var A={UPDATE_CUSTOMER_YEAR_ACTION:y.md},O=(0,d.$j)((function(e){return{customer_year:e.update_reducer.customer_year}}),A)(E),w=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;(0,s.Z)(this,r);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={redirect:!1,spinner:!1,customer_spinner:!1,didnt_load:!1,customer_list:e.props.customer_list?e.props.customer_list:[],customer:e.props.customer_list?e.props.customer_list[0]:null,customer_name:null,customer_id:null,dashboard_metric:e.props.dashboard_metric,currency_type:e.props.currency_type,customer_year:e.props.customer_year},e.onSearchChange=function(t){""===t||void 0===t||null===t?e.setState({customer_list:e.props.customer_list}):e.setState({customer_name:t})},e.onSearch=function(t){t.preventDefault();var r=e.state.customer_name,n=e.props.customer_list;n=n.filter((function(e){return e.name.toLowerCase().includes(r.toLowerCase())})),e.setState({customer_list:n})},e.onClick=function(){var t=(0,n.Z)(u().mark((function t(r){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((n=(n=e.state.customer_list).filter((function(e){return e.id===parseInt(r)}))).length>0)){t.next=7;break}return t.next=5,e.setState({customer_id:n[0].id,customer_spinner:!0});case 5:return t.next=7,e.props.GET_CUSTOMER_DETAIL_ACTION(n[0].id);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.componentDidMount=(0,n.Z)(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({spinner:!0}),t.next=3,e.props.UPDATE_CUSTOMER_YEAR_ACTION((new Date).getFullYear());case 3:case"end":return t.stop()}}),t)}))),e}return(0,a.Z)(r,[{key:"render",value:function(){var e=this,t=this.state,r=t.spinner,n=t.customer_year,s=null;try{s=this.state.dashboard_metric?this.state.customer.revenue:this.state.customer.quantity}catch(a){}return this.state.redirect?(0,C.jsx)(v.Fg,{to:"/login"}):(0,C.jsxs)(x.Z,{header_title:"CUSTOMERS",children:[r||void 0===this.props.customer_list||void 0===this.props.customer_detail?(0,C.jsx)(b.Z,{spinner:r}):null,void 0!==this.props.customer_list?(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{children:(0,C.jsx)(O,{})}),(0,C.jsxs)(h.Z,{children:[(0,C.jsx)(m.Z,{xs:3,children:(0,C.jsxs)("div",{className:"customer-side chart-area",children:[(0,C.jsx)("h6",{children:"Pick a customer"}),(0,C.jsxs)(p.Z,{className:"d-flex",onSubmit:this.onSearch,children:[(0,C.jsx)(_.Z,{type:"search",placeholder:"Search",className:"me-2","aria-label":"Search",size:"sm",onChange:function(t){return e.onSearchChange(t.target.value)}}),(0,C.jsx)(f.Z,{type:"submit",variant:"outline-primary",size:"sm",children:"Search"})]}),(0,C.jsx)("div",{children:this.state.customer_list.map((function(t,r){return(0,C.jsx)("div",{className:"customer-side__scroll",children:e.state.customer_id===t.id?(0,C.jsx)(f.Z,{className:"customer-side__customer customer-side__active",variant:"transparent",onClick:function(){return e.onClick(t.id)},children:(0,C.jsxs)("div",{className:"customer-side__info",children:[(0,C.jsx)("div",{className:"customer-side__profile"}),(0,C.jsx)("div",{children:(0,C.jsx)("h6",{className:"customer-side__name",children:t.name})})]})}):(0,C.jsx)(f.Z,{className:"customer-side__customer",variant:"transparent",onClick:function(){return e.onClick(t.id)},children:(0,C.jsxs)("div",{className:"customer-side__info",children:[(0,C.jsx)("div",{className:"customer-side__profile"}),(0,C.jsx)("div",{children:(0,C.jsx)("h6",{className:"customer-side__name",children:t.name})})]})})},r)}))})]})}),(0,C.jsx)(m.Z,{xs:9,style:{position:"relative"},children:this.state.customer_spinner||void 0===s?(0,C.jsx)(b.Z,{spinner:this.state.customer_spinner}):(0,C.jsxs)("div",{children:[(0,C.jsx)(Z,{customer:s,name:this.state.customer?this.state.customer.name:null,customer_year:n}),(0,C.jsx)(S,{customer:s,customer_year:n,dashboard_metric:this.state.dashboard_metric,currency_type:this.state.currency_type})]})})]})]}):null]})}}]),r}(l.Component);w.getDerivedStateFromProps=function(){var e=(0,n.Z)(u().mark((function e(t,r){var n,s,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.token,s=t.customer_list,a=t.customer_detail,void 0!==n&&""!==n){e.next=6;break}return r.redirect=!0,e.abrupt("return",r);case 6:if(null!==r.customer_id&&void 0!==a){e.next=14;break}return r.customer_id=s[0].id,r.spinner=!1,r.customer_spinner=!0,e.next=12,t.GET_CUSTOMER_DETAIL_ACTION(s[0].id);case 12:e.next=15;break;case 14:void 0!==a&&r.customer_id==a.id?(r.customer=a,r.customer_spinner=!1,r.spinner=!1):void 0!==a&&r.customer_id!==a.id?r.customer_spinner=!0:(r.spinner=!1,r.customer_spinner=!1,r.customer_id=t.customer_detail.id);case 15:return r.customer_list=s,r.dashboard_metric=t.dashboard_metric,r.currency_type=t.currency_type,r.customer_year=t.customer_year,e.abrupt("return",r);case 20:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();var D={GET_CUSTOMER_LIST_ACTION:y.lM,GET_CUSTOMER_DETAIL_ACTION:y.w5,UPDATE_CUSTOMER_YEAR_ACTION:y.md},I=(0,d.$j)((function(e){return{token:e.auth_reducer.token,customer_list:e.list_reducer.customer_list,customer_detail:e.list_reducer.customer_detail,dashboard_metric:e.update_reducer.dashboard_metric,currency_type:e.update_reducer.currency_type,customer_year:e.update_reducer.customer_year}}),D)(w)},3847:function(e,t,r){r.d(t,{$G:function(){return a},P:function(){return s},zI:function(){return n}});var n=function(e,t){return e.setMonth(e.getMonth()+t),e},s=function(e){return"Million"===e?"m":"k"},a=function(e){return parseFloat(e.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0])}},4475:function(e,t,r){r.d(t,{Z:function(){return k}});var n=r(5671),s=r(3144),a=r(136),i=r(5716),o=r(2791),c=r(7022),u=r(3360),l=r(6168),d=r(6856),h=r(3504),m=r(6871),p=r(5861),_=r(7757),f=r.n(_),v=r(717),x=r(4650),y=r(184),j=function(e){(0,a.Z)(r,e);var t=(0,i.Z)(r);function r(){var e;(0,n.Z)(this,r);for(var s=arguments.length,a=new Array(s),i=0;i<s;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).state={currency_type:e.props.currency_type},e.handleCurrencyTypeChange=function(){var t=(0,p.Z)(f().mark((function t(r){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.props.UPDATE_CURRENCY_TYPE_ACTION(r);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return(0,s.Z)(r,[{key:"render",value:function(){var e=this;return(0,y.jsxs)("div",{className:"header",children:[(0,y.jsx)("h5",{children:this.props.header_title}),(0,y.jsxs)("div",{className:"header__left",children:[(0,y.jsx)(v.Z.Group,{className:"header__currency",controlId:"exampleForm.ControlInput1",children:(0,y.jsxs)(v.Z.Select,{"aria-label":"Default select example",size:"sm",onChange:function(t){return e.handleCurrencyTypeChange(t.target.value)},children:[(0,y.jsx)("option",{children:this.state.currency_type}),["Million","Thousand"].map((function(t,r){return e.state.currency_type===t?null:(0,y.jsx)("option",{value:t,children:t},r)}))]})}),(0,y.jsxs)(u.Z,{variant:"secondary",size:"sm",children:[this.props.first_name[0],this.props.last_name[0]]}),(0,y.jsxs)("p",{className:"header__header-name",children:[this.props.first_name," ",this.props.last_name]})]})]})}}]),r}(o.Component);j.getDerivedStateFromProps=function(){var e=(0,p.Z)(f().mark((function e(t,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.currency_type=t.currency_type,e.abrupt("return",r);case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();var C={UPDATE_CURRENCY_TYPE_ACTION:x.wS},N=(0,l.$j)((function(e){return{currency_type:e.update_reducer.currency_type}}),C)(j),Z=r(7883),b=function(e){(0,a.Z)(r,e);var t=(0,i.Z)(r);function r(){var e;(0,n.Z)(this,r);for(var s=arguments.length,a=new Array(s),i=0;i<s;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).state={redirect:!1},e.handleLogOut=function(){e.props.USER_LOGGED_OUT_ACTION(),e.setState({redirect:!0})},e}return(0,s.Z)(r,[{key:"render",value:function(){return this.state.redirect?(0,y.jsx)(m.Fg,{to:"/login"}):(0,y.jsxs)(c.Z,{fluid:!0,className:"layout_main",children:[(0,y.jsxs)("div",{className:"layout_main__side",children:[(0,y.jsx)(h.rU,{to:"/",className:"layout_main__logo",children:(0,y.jsx)("img",{src:"".concat(Z.J,"/static/opl_logo.png"),alt:"logo",className:"layout_main__logo--img"})}),(0,y.jsxs)("div",{className:"layout_main__links",children:[!0===this.props.token.is_staff?(0,y.jsx)(h.OL,{to:"/",className:"layout_main__button",children:(0,y.jsxs)("h6",{children:[(0,y.jsx)("span",{className:"layout_main__links--span",children:(0,y.jsx)(d.bUq,{size:20,color:"#D04D30"})}),"Dashboard"]})}):null,(0,y.jsx)(h.OL,{to:"/depots",className:"layout_main__button",children:(0,y.jsxs)("h6",{children:[(0,y.jsx)("span",{className:"layout_main__links--span",children:(0,y.jsx)(d.UDA,{})}),"Depots"]})}),!0===this.props.token.is_staff?(0,y.jsx)(h.OL,{to:"/sales",className:"layout_main__button",children:(0,y.jsxs)("h6",{children:[(0,y.jsx)("span",{className:"layout_main__links--span",children:(0,y.jsx)(d.jvR,{})}),"Sales"]})}):null,!0===this.props.token.is_staff?(0,y.jsx)(h.OL,{to:"/customers",className:"layout_main__button",children:(0,y.jsxs)("h6",{children:[(0,y.jsx)("span",{className:"layout_main__links--span",children:(0,y.jsx)(d.J8I,{})}),"Customers"]})}):null,(0,y.jsx)(u.Z,{variant:"transparent",className:"layout_main__button layout_main__logout",onClick:this.handleLogOut,children:(0,y.jsxs)("h6",{children:[(0,y.jsx)("span",{className:"layout_main__links--span",children:(0,y.jsx)(d.lE7,{})}),"Log Out"]})})]})]}),(0,y.jsxs)("div",{className:"layout_main__component",children:[(0,y.jsx)(N,{header_title:this.props.header_title,first_name:this.props.token.data.first_name,last_name:this.props.token.data.last_name}),this.props.children]})]})}}]),r}(o.Component),g={USER_LOGGED_OUT_ACTION:x.$},k=(0,l.$j)((function(e){return{token:e.auth_reducer.token}}),g)(b)},2591:function(e,t,r){var n=r(1413),s=r(5987),a=r(1694),i=r.n(a),o=r(2791),c=r(162),u=r(184),l=["bsPrefix","className","striped","bordered","borderless","hover","size","variant","responsive"],d=o.forwardRef((function(e,t){var r=e.bsPrefix,a=e.className,o=e.striped,d=e.bordered,h=e.borderless,m=e.hover,p=e.size,_=e.variant,f=e.responsive,v=(0,s.Z)(e,l),x=(0,c.vE)(r,"table"),y=i()(a,x,_&&"".concat(x,"-").concat(_),p&&"".concat(x,"-").concat(p),o&&"".concat(x,"-striped"),d&&"".concat(x,"-bordered"),h&&"".concat(x,"-borderless"),m&&"".concat(x,"-hover")),j=(0,u.jsx)("table",(0,n.Z)((0,n.Z)({},v),{},{className:y,ref:t}));if(f){var C="".concat(x,"-responsive");return"string"===typeof f&&(C="".concat(C,"-").concat(f)),(0,u.jsx)("div",{className:C,children:j})}return j}));t.Z=d}}]);
//# sourceMappingURL=724.7e56f858.chunk.js.map